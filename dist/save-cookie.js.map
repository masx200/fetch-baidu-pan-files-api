{"version":3,"file":"save-cookie.js","sources":["../lib/files.ts","../cli/save-cookie.ts","../cli/parse-cookie-save.ts"],"sourcesContent":["import os from \"os\";\nimport path from \"path\";\n// import { fileURLToPath } from \"url\";\n// const __filename = fileURLToPath(import.meta.url);\n// const __dirname = dirname(__filename);\nconst datadirname = path.join(os.homedir(), \"baidupan\", \"./userdata\");\nconst bdstokenfile = path.resolve(datadirname, \"./bdstoken.txt\");\nconst jsonfile = path.resolve(datadirname, \"./cookies.json\");\n\nexport { jsonfile, bdstokenfile };\n","// #!/usr/bin/env node\nimport path from \"path\";\nimport fsextra from \"fs-extra\";\nimport process from \"process\";\nimport { bdstokenfile, jsonfile } from \"../lib/files\";\nimport { parsecookiesave } from \"./parse-cookie-save\";\nimport parse from \"@masx200/mini-cli-args-parser\";\nconsole.log(process.argv.slice(2));\nconst opts = parse(process.argv.slice(2));\nconst cookiestr = opts[\"cookie\"];\nconst bdstoken = opts[\"bdstoken\"];\nprocess.on(\"unhandledRejection\", (err) => {\n    throw err;\n});\nconsole.log(opts);\n~(async () => {\n    console.log(cookiestr);\n    if (cookiestr) {\n        await fsextra.ensureDir(path.dirname(jsonfile));\n\n        await parsecookiesave(cookiestr);\n        console.log(\"cookie 保存成功\");\n    } else {\n        throw new TypeError(\"invalid cookie\");\n    }\n    console.log(bdstoken);\n    if (bdstoken) {\n        await fsextra.ensureDir(path.dirname(bdstokenfile));\n        await fsextra.writeFile(bdstokenfile, bdstoken);\n\n        console.log(\"bdstoken 保存成功\");\n    } else {\n        throw new TypeError(\"invalid bdstoken\");\n    }\n})();\n","import cookie from \"cookie\";\nimport fsextra from \"fs-extra\";\n\nimport { jsonfile } from \"../lib/files.js\";\n\nexport const parsecookiesave = async (cookiestr: string) => {\n    // const buf = await fsextra.readFile();\n    // const cookiestr = buf.toString();\n    console.log(cookiestr);\n    const parsedobj = cookie.parse(cookiestr, {});\n    console.log(parsedobj);\n    await fsextra.writeJSON(jsonfile, parsedobj, { spaces: 4 });\n};\n"],"names":["datadirname","path","join","os","homedir","bdstokenfile","resolve","jsonfile","console","log","process","argv","slice","opts","parse","cookiestr","bdstoken","on","err","TypeError","fsextra","ensureDir","dirname","async","parsedobj","cookie","writeJSON","spaces","parsecookiesave","writeFile"],"mappings":";;;;;;;;;;;;;AAKA,MAAMA,IAAcC,EAAKC,KAAKC,EAAGC,WAAW,YAAY,eAClDC,IAAeJ,EAAKK,QAAQN,GAAa,mBACzCO,IAAWN,EAAKK,QAAQN,GAAa;;ACA3CQ,QAAQC,IAAIC,EAAQC,KAAKC,MAAM;;AAC/B,MAAMC,IAAOC,EAAMJ,EAAQC,KAAKC,MAAM,KAChCG,IAAYF,EAAa,QACzBG,IAAWH,EAAe;;AAChCH,EAAQO,GAAG,uBAAuBC;IAC9B,MAAMA;KAEVV,QAAQC,IAAII,IACX;IAEG,IADAL,QAAQC,IAAIM,KACRA,GAMA,MAAM,IAAII,UAAU;IAGxB,UARUC,EAAQC,UAAUpB,EAAKqB,QAAQf,WCbdgB,OAAOR;QAGlCP,QAAQC,IAAIM;QACZ,MAAMS,IAAYC,EAAOX,MAAMC,GAAW;QAC1CP,QAAQC,IAAIe,UACNJ,EAAQM,UAAUnB,GAAUiB,GAAW;YAAEG,QAAQ;;MDS7CC,CAAgBb,IACtBP,QAAQC,IAAI,gBAIhBD,QAAQC,IAAIO,KACRA,GAMA,MAAM,IAAIG,UAAU;UALdC,EAAQC,UAAUpB,EAAKqB,QAAQjB,WAC/Be,EAAQS,UAAUxB,GAAcW,IAEtCR,QAAQC,IAAI;EAfnB"}